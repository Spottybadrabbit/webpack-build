{"version":3,"sources":["../src/build.js"],"names":[],"mappings":";;;;oBAAiB,MAAM;;;;kBACR,IAAI;;;;sBACA,QAAQ;;;;wBACT,iBAAiB;;;;0BACf,mBAAmB;;;;2BAClB,oBAAoB;;;;wBACvB,iBAAiB;;;;8BAChB,wBAAwB;;;;qBACzB,SAAS;;;;AAE3B,IAAI,MAAM,GAAG,mBAAM,MAAM,CAAC;AAC1B,IAAI,SAAS,GAAG,kBAAK,IAAI,CAAC,mBAAM,eAAe,EAAE,WAAW,CAAC,CAAC;;;AAG9D,UAAU,CAAC,YAAM;AACf,2BAAS,KAAK,EAAE,CAAC;AACjB,8BAAO,KAAK,EAAE,CAAC;AACf,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;AACH,SAAS,CAAC,YAAM;AACd,2BAAS,KAAK,EAAE,CAAC;AACjB,8BAAO,KAAK,EAAE,CAAC;AACf,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;;AAEH,QAAQ,CAAC,OAAO,EAAE,YAAM;AACtB,IAAE,CAAC,sBAAsB,EAAE,YAAM;AAC/B,UAAM,CAAC,UAAU,uBAAO,CAAC;GAC1B,CAAC,CAAC;AACH,IAAE,CAAC,8CAA8C,EAAE,YAAM;AACvD,QAAI,IAAI,GAAG;AACT,YAAM,EAAE,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,gBAAgB,CAAC;AAC9E,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,+BAAM,IAAI,EAAE,YAAM,EAAE,CAAC,CAAC;GACvB,CAAC,CAAC;AACH,IAAE,CAAC,iCAAiC,EAAE,YAAM;AAC1C,QAAI,YAAY,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,gBAAgB,CAAC,CAAC;AAC1F,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY;AACpB,WAAK,EAAE,IAAI;AACX,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;;AAE7D,QAAI,QAAQ,GAAG,2BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACtC,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAC7D,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,QAAQ,CAAC,CAAC;AACvE,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;;AAEzE,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY;AACpB,WAAK,EAAE,IAAI;AACX,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,QAAI,QAAQ,GAAG,2BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACtC,UAAM,CAAC,WAAW,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACvC,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAC7D,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,QAAQ,CAAC,CAAC;AACvE,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;;AAEzE,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY;AACpB,WAAK,EAAE,KAAK;AACZ,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,QAAI,QAAQ,GAAG,2BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACtC,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAC7D,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,QAAQ,CAAC,CAAC;AACvE,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;;AAEzE,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY,GAAG,MAAM;AAC7B,WAAK,EAAE,KAAK;AACZ,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,QAAI,QAAQ,GAAG,2BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACtC,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;AAC7D,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,QAAQ,CAAC,CAAC;AACvE,UAAM,CAAC,WAAW,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;;AAEzE,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY,GAAG,MAAM;AAC7B,WAAK,EAAE,KAAK;AACZ,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,+BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACvB,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;;AAE7D,QAAI,KAAK,GAAG;AACV,YAAM,EAAE,YAAY;AACpB,WAAK,EAAE,IAAI;AACX,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,CAAC;AACF,+BAAM,KAAK,EAAE,YAAM,EAAE,CAAC,CAAC;AACvB,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAM,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;GAC9D,CAAC,CAAC;AACH,IAAE,CAAC,qCAAqC,EAAE,UAAC,IAAI,EAAK;AAClD,+BAAM;AACJ,YAAM,EAAE,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,gBAAgB,CAAC;AAC9E,YAAM,EAAE,IAAI;AACZ,cAAQ,EAAE,SAAS;KACpB,EAAE,UAAC,GAAG,EAAE,IAAI,EAAK;AAChB,YAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,YAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;AAEtB,YAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;AACpC,YAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;AAEpC,UAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;AAC/C,YAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;;AAE1B,sBAAG,QAAQ,CAAC,QAAQ,EAAE,UAAC,GAAG,EAAE,QAAQ,EAAK;AACvC,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,YAAI,cAAc,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC;AACzC,cAAM,CAAC,OAAO,CAAC,cAAc,EAAE,6BAA6B,CAAC,CAAC;AAC9D,cAAM,CAAC,OAAO,CAAC,cAAc,EAAE,+BAA+B,CAAC,CAAC;AAChE,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;AACH,UAAQ,CAAC,YAAY,EAAE,YAAM;AAC3B,MAAE,CAAC,mDAAmD,EAAE,UAAC,IAAI,EAAK;AAChE,UAAI,SAAS,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,qBAAqB,CAAC,CAAC;AAC5D,UAAI,UAAU,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,mBAAmB,CAAC,CAAC;;AAE3F,0BAAO,IAAI,CAAC,kBAAK,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;;AAErC,sBAAG,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC;AACzC,iBAAS,EAAE,CAAC,IAAI,IAAI,EAAE,GAAG,IAAI;AAC7B,wBAAgB,EAAE,EAAE;AACpB,oBAAY,EAAE,EAAE;AAChB,aAAK,EAAE;AACL,cAAI,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC;SACnB;AACD,cAAM,EAAE,UAAU;AAClB,iBAAS,EAAE,KAAK;OACjB,CAAC,CAAC,CAAC;;AAEJ,iCAAM;AACJ,cAAM,EAAE,UAAU;AAClB,iBAAS,EAAE,SAAS;AACpB,cAAM,EAAE,IAAI;AACZ,iBAAS,EAAE,KAAK;OACjB,EAAE,UAAC,GAAG,EAAE,IAAI,EAAK;AAChB,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;AAEtB,cAAM,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,EAAC,IAAI,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC,EAAC,CAAC,CAAC;AACnD,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;AACH,MAAE,CAAC,+CAA+C,EAAE,UAAC,IAAI,EAAK;AAC5D,UAAI,UAAU,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,mBAAmB,CAAC,CAAC;;AAE3F,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,UAAU;AAClB,gBAAQ,EAAE,SAAS;AACnB,cAAM,EAAE,IAAI;OACb,CAAC;;AAEF,iCAAM,IAAI,EAAE,UAAC,GAAG,EAAE,IAAI,EAAK;AACzB,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;AAEtB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AAChC,cAAM,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;;AAE9C,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;AACH,MAAE,CAAC,oEAAoE,EAAE,UAAC,IAAI,EAAK;AACjF,UAAI,UAAU,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,mBAAmB,CAAC,CAAC;;AAE3F,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,UAAU;AAClB,gBAAQ,EAAE,SAAS;AACnB,aAAK,EAAE,KAAK;AACZ,cAAM,EAAE,IAAI;OACb,CAAC;;AAEF,UAAI,OAAO,GAAG,2BAAM,IAAI,EAAE,UAAC,GAAG,EAAE,IAAI,EAAK;AACvC,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;AAEtB,cAAM,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;;AAEvC,8BAAM,GAAG,CAAC,IAAI,EAAE,UAAC,IAAI,EAAE,KAAK,EAAK;AAC/B,gBAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACpB,gBAAM,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;;AAE9B,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAC7B,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AAChC,gBAAM,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,kBAAK,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC;;AAE7E,gBAAM,CAAC,KAAK,CAAC,4BAAO,GAAG,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;;AAExD,cAAI,EAAE,CAAC;SACR,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ,CAAC,CAAC;AACH,MAAE,CAAC,8DAA8D,EAAE,UAAC,IAAI,EAAK;AAC3E,UAAI,SAAS,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,yCAAyC,CAAC,CAAC;AAChF,UAAI,UAAU,GAAG,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,mBAAmB,CAAC,CAAC;;AAE3F,0BAAO,IAAI,CAAC,kBAAK,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;;AAErC,sBAAG,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC;AACzC,iBAAS,EAAE,CAAC,IAAI,IAAI,EAAE,GAAG,IAAI;AAC7B,wBAAgB,EAAE,EAAE;AACpB,oBAAY,EAAE,EAAE;AAChB,aAAK,EAAE;AACL,cAAI,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC;SACnB;AACD,cAAM,EAAE,UAAU;AAClB,iBAAS,EAAE,KAAK;OACjB,CAAC,CAAC,CAAC;;AAEJ,UAAI,IAAI,GAAG;AACT,cAAM,EAAE,UAAU;AAClB,iBAAS,EAAE,SAAS;AACpB,aAAK,EAAE,IAAI;AACX,cAAM,EAAE,IAAI;AACZ,iBAAS,EAAE,KAAK;OACjB,CAAC;;AAEF,UAAI,OAAO,GAAG,2BAAM,IAAI,EAAE,UAAC,GAAG,EAAE,KAAK,EAAK;AACxC,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACvB,cAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,EAAC,IAAI,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC,EAAC,CAAC,CAAC;;AAEpD,cAAM,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;;AAEtD,YAAI,MAAM,GAAG,4BAAO,GAAG,CAAC,IAAI,CAAC,CAAC;AAC9B,cAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACjD,cAAM,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;;AAEhC,mCAAM,IAAI,EAAE,UAAC,GAAG,EAAE,KAAK,EAAK;AAC1B,gBAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,gBAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;;AAEvB,gBAAM,CAAC,WAAW,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;AACjC,gBAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,EAAC,IAAI,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC,EAAC,CAAC,CAAC;AACpD,gBAAM,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;;AAEhC,oBAAU,CAAC,YAAM;AACf,mBAAO,CAAC,QAAQ,CAAC,UAAC,GAAG,EAAE,KAAK,EAAK;AAC/B,oBAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,oBAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACvB,oBAAM,CAAC,cAAc,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;;AAEpC,oBAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACvC,oBAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;AACpD,oBAAM,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;;AAE5D,oBAAM,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;;AAE/B,yCAAM,IAAI,EAAE,UAAC,GAAG,EAAE,KAAK,EAAK;AAC1B,sBAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,sBAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACvB,sBAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;;AAE3C,oBAAI,EAAE,CAAC;eACR,CAAC,CAAC;aACJ,CAAC,CAAC;WACJ,EAAE,EAAE,CAAC,CAAC;SACR,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ,CAAC,CAAC","file":"build.js","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport build from '../../lib/index';\nimport Wrapper from '../../lib/Wrapper';\nimport wrappers from '../../lib/wrappers'\nimport cache from '../../lib/cache';\nimport caches from '../../lib/cache/caches';\nimport utils from './utils';\n\nlet assert = utils.assert;\nlet CACHE_DIR = path.join(utils.TEST_OUTPUT_DIR, 'cache_dir');\n\n// Ensure we have a clean slate before and after each test\nbeforeEach(() => {\n  wrappers.clear();\n  caches.clear();\n  utils.cleanTestOutputDir();\n});\nafterEach(() => {\n  wrappers.clear();\n  caches.clear();\n  utils.cleanTestOutputDir();\n});\n\ndescribe('build', () => {\n  it('should be a function', () => {\n    assert.isFunction(build);\n  });\n  it('should accept options and callback arguments', () => {\n    let opts = {\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config'),\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    build(opts, () => {});\n  });\n  it('should populate the bundle list', () => {\n    let pathToConfig = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config');\n    let opts1 = {\n      config: pathToConfig,\n      watch: true,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 0);\n\n    let wrapper1 = build(opts1, () => {});\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 1);\n    assert.strictEqual(build.wrappers.wrappers[opts1.buildHash], wrapper1);\n    assert.strictEqual(build.wrappers.wrappers[opts1.buildHash].opts, opts1);\n\n    let opts2 = {\n      config: pathToConfig,\n      watch: true,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    let wrapper2 = build(opts2, () => {});\n    assert.strictEqual(wrapper2, wrapper1);\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 1);\n    assert.strictEqual(build.wrappers.wrappers[opts2.buildHash], wrapper2);\n    assert.strictEqual(build.wrappers.wrappers[opts2.buildHash].opts, opts1);\n\n    let opts3 = {\n      config: pathToConfig,\n      watch: false,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    let wrapper3 = build(opts3, () => {});\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 2);\n    assert.strictEqual(build.wrappers.wrappers[opts3.buildHash], wrapper3);\n    assert.strictEqual(build.wrappers.wrappers[opts3.buildHash].opts, opts3);\n\n    let opts4 = {\n      config: pathToConfig + 'test',\n      watch: false,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    let wrapper4 = build(opts4, () => {});\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 3);\n    assert.strictEqual(build.wrappers.wrappers[opts4.buildHash], wrapper4);\n    assert.strictEqual(build.wrappers.wrappers[opts4.buildHash].opts, opts4);\n\n    let opts5 = {\n      config: pathToConfig + 'test',\n      watch: false,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    build(opts5, () => {});\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 3);\n\n    let opts6 = {\n      config: pathToConfig,\n      watch: true,\n      logger: null,\n      cacheDir: CACHE_DIR\n    };\n    build(opts6, () => {});\n    assert.equal(Object.keys(build.wrappers.wrappers).length, 3);\n  });\n  it('should be able to generate a bundle', (done) => {\n    build({\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config'),\n      logger: null,\n      cacheDir: CACHE_DIR\n    }, (err, data) => {\n      assert.isNull(err);\n      assert.isObject(data);\n\n      assert.isObject(data.pathsToAssets);\n      assert.isObject(data.webpackConfig);\n\n      let existsAt = data.pathsToAssets['output.js'];\n      assert.isString(existsAt);\n\n      fs.readFile(existsAt, (err, contents) => {\n        assert.isNull(err);\n        let compiledBundle = contents.toString();\n        assert.include(compiledBundle, '__BASIC_BUNDLE_ENTRY_TEST__');\n        assert.include(compiledBundle, '__BASIC_BUNDLE_REQUIRE_TEST__');\n        done();\n      });\n    });\n  });\n  describe('file cache', () => {\n    it('should respect the cacheDir and cacheFile options', (done) => {\n      let cacheFile = path.join(CACHE_DIR, 'test_cacheFile.json');\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      mkdirp.sync(path.dirname(cacheFile));\n\n      fs.writeFileSync(cacheFile, JSON.stringify({\n        startTime: +new Date() + 2000,\n        fileDependencies: [],\n        dependencies: [],\n        stats: {\n          test: {foo: 'bar'}\n        },\n        config: configFile,\n        buildHash: 'foo'\n      }));\n\n      build({\n        config: configFile,\n        cacheFile: cacheFile,\n        logger: null,\n        buildHash: 'foo'\n      }, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.deepEqual(data.stats, {test: {foo: 'bar'}});\n        done();\n      });\n    });\n    it('should generate a cache file in the cache dir', (done) => {\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      let opts = {\n        config: configFile,\n        cacheDir: CACHE_DIR,\n        logger: null\n      };\n\n      build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.isString(opts.cacheFile);\n        assert.include(opts.cacheFile, opts.cacheDir);\n\n        done();\n      });\n    });\n    it('should generate a cache file from the config file and options hash', (done) => {\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      let opts = {\n        config: configFile,\n        cacheDir: CACHE_DIR,\n        watch: false,\n        logger: null\n      };\n\n      let wrapper = build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.strictEqual(wrapper.opts, opts);\n\n        cache.get(opts, (_err, _data) => {\n          assert.isNull(_err);\n          assert.deepEqual(_data, data);\n\n          assert.isString(opts.config);\n          assert.isString(opts.buildHash);\n          assert.equal(opts.cacheFile, path.join(CACHE_DIR, opts.buildHash + '.json'));\n\n          assert.equal(caches.get(opts).filename, opts.cacheFile);\n\n          done();\n        });\n      });\n    });\n    it('should stop serving cached data once a watcher has completed', (done) => {\n      let cacheFile = path.join(CACHE_DIR, 'test_cache_stops_once_watcher_done.json');\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      mkdirp.sync(path.dirname(cacheFile));\n\n      fs.writeFileSync(cacheFile, JSON.stringify({\n        startTime: +new Date() + 2000,\n        fileDependencies: [],\n        dependencies: [],\n        stats: {\n          test: {foo: 'bar'}\n        },\n        config: configFile,\n        buildHash: 'foo'\n      }));\n\n      let opts = {\n        config: configFile,\n        cacheFile: cacheFile,\n        watch: true,\n        logger: null,\n        buildHash: 'foo'\n      };\n\n      let wrapper = build(opts, (err, data1) => {\n        assert.isNull(err);\n        assert.isObject(data1);\n        assert.deepEqual(data1.stats, {test: {foo: 'bar'}});\n\n        assert.strictEqual(wrapper.opts.cacheFile, cacheFile);\n\n        let _cache = caches.get(opts);\n        assert.deepEqual(data1.stats, _cache.data.stats);\n        assert.isFalse(_cache.delegate);\n\n        build(opts, (err, data2) => {\n          assert.isNull(err);\n          assert.isObject(data2);\n\n          assert.strictEqual(data2, data1);\n          assert.deepEqual(data2.stats, {test: {foo: 'bar'}});\n          assert.isFalse(_cache.delegate);\n\n          setTimeout(() => {\n            wrapper.onceDone((err, data3) => {\n              assert.isNull(err);\n              assert.isObject(data3);\n              assert.notStrictEqual(data3, data2);\n\n              assert.isString(_cache.data.buildHash);\n              assert.equal(_cache.data.buildHash, opts.buildHash);\n              assert.equal(_cache.data.buildHash, wrapper.opts.buildHash);\n\n              assert.isTrue(_cache.delegate);\n\n              build(opts, (err, data4) => {\n                assert.isNull(err);\n                assert.isObject(data4);\n                assert.deepEqual(data4.stats, data3.stats);\n\n                done();\n              });\n            });\n          }, 50);\n        });\n      });\n    });\n  });\n});"]}