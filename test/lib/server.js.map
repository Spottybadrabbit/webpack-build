{"version":3,"sources":["../src/server.js"],"names":[],"mappings":";;;;oBAAiB,MAAM;;;;kBACR,IAAI;;;;sBACA,QAAQ;;;;wBACT,iBAAiB;;;;kCACf,4BAA4B;;;;2BAC3B,oBAAoB;;;;wBACvB,iBAAiB;;;;yBAChB,kBAAkB;;;;uBACjB,SAAS;;;;qBACX,SAAS;;;;AAE3B,IAAI,eAAe,GAAG,mBAAM,eAAe,CAAC;AAC5C,IAAI,MAAM,GAAG,mBAAM,MAAM,CAAC;;;AAG1B,UAAU,CAAC,YAAM;AACf,2BAAS,KAAK,EAAE,CAAC;AACjB,wBAAM,KAAK,EAAE,CAAC;AACd,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;AACH,SAAS,CAAC,YAAM;AACd,2BAAS,KAAK,EAAE,CAAC;AACjB,wBAAM,KAAK,EAAE,CAAC;AACd,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;;AAEH,QAAQ,CAAC,QAAQ,EAAE,YAAM;AACvB,IAAE,CAAC,sDAAsD,EAAE,UAAC,IAAI,EAAK;AACnE,QAAI,IAAI,GAAG;AACT,YAAM,EAAE,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,gBAAgB,CAAC;KAC/E,CAAC;AACF,2BAAO,MAAM,CAAC,IAAI,EAAE,YAAW;AAC7B,2BAAQ,IAAI,CAAC;AACX,WAAG,EAAE,uBAAuB;AAC5B,YAAI,EAAE,IAAI;AACV,YAAI,EAAE,IAAI;OACX,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC1B,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtB,cAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC1B,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC3B,mCAAM,IAAI,EAAE,UAAS,GAAG,EAAE,IAAI,EAAE;AAC9B,gBAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtB,gBAAM,CAAC,SAAS,CACd,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CACjC,CAAC;AACF,iCAAO,KAAK,EAAE,CAAC;AACf,cAAI,EAAE,CAAC;SACR,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;AACH,IAAE,CAAC,kDAAkD,EAAE,UAAC,IAAI,EAAK;AAC/D,2BAAO,MAAM,CAAC,IAAI,EAAE,YAAW;AAC7B,gCAAQ,uBAAuB,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AACxD,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtB,cAAM,CAAC,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AAC/B,cAAM,CAAC,OAAO,CAAC,IAAI,EAAE,sBAAsB,CAAC,CAAC;AAC7C,+BAAO,KAAK,EAAE,CAAC;AACf,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ,CAAC,CAAC","file":"server.js","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport build from '../../lib/index';\nimport Wrapper from '../../lib/wrappers/Wrapper';\nimport wrappers from '../../lib/wrappers'\nimport cache from '../../lib/cache';\nimport server from '../../lib/server';\nimport request from 'request';\nimport utils from './utils';\n\nlet TEST_OUTPUT_DIR = utils.TEST_OUTPUT_DIR;\nlet assert = utils.assert;\n\n// Ensure we have a clean slate before and after each test\nbeforeEach(() => {\n  wrappers.clear();\n  cache.clear();\n  utils.cleanTestOutputDir();\n});\nafterEach(() => {\n  wrappers.clear();\n  cache.clear();\n  utils.cleanTestOutputDir();\n});\n\ndescribe('server', () => {\n  it('should accept POST requests and pass them to `build`', (done) => {\n    let opts = {\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config')\n    };\n    server.listen(9009, function() {\n      request.post({\n        url: 'http://127.0.0.1:9009',\n        json: true,\n        body: opts\n      }, function(err, res, body) {\n        assert.isNull(err);\n        assert.isObject(body);\n        assert.isNull(body.error);\n        assert.isObject(body.data);\n        build(opts, function(err, data) {\n          assert.isNull(err);\n          assert.isObject(data);\n          assert.deepEqual(\n            body.data,\n            JSON.parse(JSON.stringify(data))\n          );\n          server.close();\n          done();\n        });\n      });\n    });\n  });\n  it('should accept GET requests and provide some info', (done) => {\n    server.listen(9009, function() {\n      request('http://127.0.0.1:9009', function(err, res, body) {\n        assert.isNull(err);\n        assert.isString(body);\n        assert.include(body, '<html>');\n        assert.include(body, 'webpack-build-server');\n        server.close();\n        done();\n      });\n    });\n  });\n});"]}