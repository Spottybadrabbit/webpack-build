{"version":3,"sources":["../src/server.js"],"names":[],"mappings":";;;;oBAAiB,MAAM;;;;kBACR,IAAI;;;;sBACA,QAAQ;;;;wBACT,iBAAiB;;;;kCACf,4BAA4B;;;;2BAC3B,oBAAoB;;;;yBACtB,kBAAkB;;;;yBAClB,kBAAkB;;;;uBACjB,SAAS;;;;qBACX,SAAS;;;;AAE3B,IAAI,eAAe,GAAG,mBAAM,eAAe,CAAC;AAC5C,IAAI,MAAM,GAAG,mBAAM,MAAM,CAAC;;;AAG1B,UAAU,CAAC,YAAM;AACf,2BAAS,KAAK,EAAE,CAAC;AACjB,yBAAO,KAAK,EAAE,CAAC;AACf,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;AACH,SAAS,CAAC,YAAM;AACd,2BAAS,KAAK,EAAE,CAAC;AACjB,yBAAO,KAAK,EAAE,CAAC;AACf,qBAAM,kBAAkB,EAAE,CAAC;CAC5B,CAAC,CAAC;;AAEH,QAAQ,CAAC,QAAQ,EAAE,YAAM;AACvB,IAAE,CAAC,sDAAsD,EAAE,UAAC,IAAI,EAAK;AACnE,QAAI,IAAI,GAAG;AACT,YAAM,EAAE,kBAAK,IAAI,CAAC,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,mBAAmB,CAAC;KAClF,CAAC;AACF,8BAAQ,uBAAuB,EAAE,UAAC,GAAG,EAAK;AACxC,YAAM,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,EAAE,+DAA+D,CAAC,CAAC;AAC/F,gBAAU,CAAC,YAAW;AACpB,+BAAO,MAAM,CAAC,IAAI,EAAE,YAAW;AAC7B,+BAAQ,IAAI,CAAC;AACX,eAAG,EAAE,uBAAuB;AAC5B,gBAAI,EAAE,IAAI;AACV,gBAAI,EAAE,IAAI;WACX,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AAC1B,kBAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,kBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtB,kBAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC1B,kBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC3B,kBAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACjD,mCAAO,KAAK,EAAE,CAAC;AACf,gBAAI,EAAE,CAAC;WACR,CAAC,CAAC;SACJ,CAAC,CAAC;OACJ,EAAE,GAAG,CAAC,CAAC;KACT,CAAC,CAAC;GACJ,CAAC,CAAC;AACH,IAAE,CAAC,kDAAkD,EAAE,UAAC,IAAI,EAAK;AAC/D,2BAAO,MAAM,CAAC,IAAI,EAAE,YAAW;AAC7B,gCAAQ,uBAAuB,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AACxD,cAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACnB,cAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACtB,cAAM,CAAC,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AAC/B,cAAM,CAAC,OAAO,CAAC,IAAI,EAAE,sBAAsB,CAAC,CAAC;AAC7C,+BAAO,KAAK,EAAE,CAAC;AACf,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ,CAAC,CAAC","file":"server.js","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport build from '../../lib/index';\nimport Wrapper from '../../lib/wrappers/Wrapper';\nimport wrappers from '../../lib/wrappers'\nimport caches from '../../lib/caches';\nimport server from '../../lib/server';\nimport request from 'request';\nimport utils from './utils';\n\nlet TEST_OUTPUT_DIR = utils.TEST_OUTPUT_DIR;\nlet assert = utils.assert;\n\n// Ensure we have a clean slate before and after each test\nbeforeEach(() => {\n  wrappers.clear();\n  caches.clear();\n  utils.cleanTestOutputDir();\n});\nafterEach(() => {\n  wrappers.clear();\n  caches.clear();\n  utils.cleanTestOutputDir();\n});\n\ndescribe('server', () => {\n  it('should accept POST requests and pass them to `build`', (done) => {\n    let opts = {\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js')\n    };\n    request('http://127.0.0.1:9009', (err) => {\n      assert.instanceOf(err, Error, 'Sanity check to make sure there isn\\'t another server running');\n      setTimeout(function() {\n        server.listen(9009, function() {\n          request.post({\n            url: 'http://127.0.0.1:9009',\n            json: true,\n            body: opts\n          }, function(err, res, body) {\n            assert.isNull(err);\n            assert.isObject(body);\n            assert.isNull(body.error);\n            assert.isObject(body.data);\n            assert.equal(body.data.config.file, opts.config);\n            server.close();\n            done();\n          });\n        });\n      }, 500);\n    });\n  });\n  it('should accept GET requests and provide some info', (done) => {\n    server.listen(9009, function() {\n      request('http://127.0.0.1:9009', function(err, res, body) {\n        assert.isNull(err);\n        assert.isString(body);\n        assert.include(body, '<html>');\n        assert.include(body, 'webpack-build-server');\n        server.close();\n        done();\n      });\n    });\n  });\n});"]}