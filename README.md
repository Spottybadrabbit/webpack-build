webpack-wrapper
===============

[![Build Status](https://travis-ci.org/markfinger/webpack-wrapper.svg?branch=master)](https://travis-ci.org/markfinger/webpack-wrapper)
[![Dependency Status](https://david-dm.org/markfinger/webpack-wrapper.svg)](https://david-dm.org/markfinger/webpack-wrapper)
[![devDependency Status](https://david-dm.org/markfinger/webpack-wrapper/dev-status.svg)](https://david-dm.org/markfinger/webpack-wrapper#info=devDependencies)

A wrapper library which provides a variety of optimisations and utilities intended to assist with 
integrating webpack into a build process.


Features
--------

- Supports multiple concurrent compilers
- A persistent caching layer which massively reduces initial and repeated build times
- Change detection for config files
- Pre-processes compiler output so that it can be serialized and passed between processes
- Provides a config helper to map the output path to a particular directory, which helps config 
  files to be both more portable and more easily integrated into larger systems
- Optimises the background compilation of webpack's watcher by writing assets to memory and 
  emitting them to disk when required


Documentation
-------------

- [Installation](#installation)
- [Basic usage](#basic-usage)
- [Configuration](#configuration)
- [Caching](#caching)


Installation
------------

```bash
npm install webpack-wrapper
```


Basic usage
-----------

```javascript
var webpack = require('webpack-wrapper');

webpack({config: '/path/to/webpack.config.js'}), function(err, stats) {
  // Besides the usual stats data produced by webpack, the wrapper adds 
  // some extra props...
  
  // The config object generated by webpack
  stats.webpackConfig
  
  // An object mapping asset names to the full path of the generated asset
  stats.pathsToAssets
});
```


Configuration
-------------

```javascript
{

  // An absolute path to a config file
  config: '/path/to/webpack.config.js',
  
  // The following options are the default values...
  
  // Indicates that webpack should watch the source files for changes 
  // and rebuild in the background
  watch: false,
  
  // Indicates that the config file should be watched for changes. 
  // Any changes will cause webpack to completely rebuild the bundle
  // on the next request
  watchConfig: false,
  
  // An absolute path to a file that will be used to store compilation 
  // output
  cacheFile: null,
  
  // The delay between the detection of a change in your source files and 
  // the start of a watcher's rebuild process
  aggregateTimeout: 200,
  
  // Indicates if the watcher should poll for changes, rather than 
  // relying on the OS for notifications
  poll: undefined,
  
  // The maximum time that compilation output will be stored for
  cacheTTL: 1000 * 60 * 60 * 24 * 30, // 30 days
  
  // Indicates that webpack's watcher should emit rebuilt files to 
  // memory until they are required to be on disk. If `cacheFile` is
  // defined, this is set to false
  useMemoryFS: true
  
  // An override for the config's `output.path` property
  outputPath: null,
  
  // A console-like object which is written to when the wrapper's state
  // changes, mostly of use for debugging. To suppress all output, set 
  // it to `null`
  logger: console
  
}
```


Caching
-------

When a request comes in and the compilation output has been cached from a previous build, the modified 
times of the config file and the file dependencies are compared against the compilation's start time.
If the modified times are later than the cached compilation's start time - or any errors are 
encountered - the cached output is ignored and the wrapper waits for webpack to recompile.

Caches are updated whenever a compilation process completes. Watchers will updated the cache whenever
a background compilation has completed.
