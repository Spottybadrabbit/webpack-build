webpack-wrapper
===============

[![Build Status](https://travis-ci.org/markfinger/webpack-wrapper.svg?branch=master)](https://travis-ci.org/markfinger/webpack-wrapper)
[![Dependency Status](https://david-dm.org/markfinger/webpack-wrapper.svg)](https://david-dm.org/markfinger/webpack-wrapper)
[![devDependency Status](https://david-dm.org/markfinger/webpack-wrapper/dev-status.svg)](https://david-dm.org/markfinger/webpack-wrapper#info=devDependencies)

A wrapper library which provides a variety of optimisations and utilities intended to assist with 
integrating webpack into a build process.


Features
--------

- Supports multiple concurrent compilers
- Uses a persistent caching layer to massively reduces initial and repeated build times
- Provides watchers to detect changes in your config files
- Pre-processes compilation output so that it can be serialized and passed between processes
- Provides a config helper to direct the compiler's output to a particular directory, which helps 
  configfiles to be both more portable and more easily integrated into larger systems


Documentation
-------------

- [Installation](#installation)
- [Basic usage](#basic-usage)
- [Configuration](#configuration)
- [Caching](#caching)


Installation
------------

```bash
npm install webpack-wrapper
```


Basic usage
-----------

```javascript
var webpack = require('webpack-wrapper');

webpack({config: '/path/to/webpack.config.js'}), function(err, stats) {
  // Besides the usual stats data produced by webpack, the wrapper adds 
  // some extra props...
  
  // The config object generated by webpack
  stats.webpackConfig
  
  // An object mapping asset names to the full path of the generated asset
  stats.pathsToAssets
  
  // An object mapping asset names to the full url of the generated asset.
  // Requires the `staticRoot` and `staticUrl` settings to be defined
  stats.urlsToAssets
});
```


Configuration
-------------

```javascript
var webpack = require('webpack-wrapper');

webpack({

  // An absolute path to a config file
  config: '/path/to/webpack.config.js',
  
  // The following options are the default values...
  
  // Indicates that webpack should watch the source files for changes 
  // and rebuild in the background
  watch: false,
  
  // Indicates that the config file should be watched for changes. 
  // Any changes will cause webpack to completely rebuild the bundle
  // on the next request
  watchConfig: false,
  
  // An absolute path to a file that will be used to store cached data
  cacheFile: null,

  // The cache key used to distinguish the current request's compilation
  cacheKey: null,
  
  // An override for the config's `output.path` property
  outputPath: null,
  
  // An absolute path to your static root, used to calculate `urlsToAssets`
  staticRoot: null,
  
  // The url that your static assets are served from, used to 
  // calculate `urlsToAssets`
  staticUrl: null,
  
  // The delay between the detection of a change in your source files and 
  // the start of a watcher's rebuild process
  aggregateTimeout: 200,
  
  // Indicates if the watcher should poll for changes, rather than 
  // relying on the OS for notifications
  poll: undefined,
  
  // The maximum time that compilation output will be cached for
  cacheTTL: 1000 * 60 * 60 * 24 * 30, // 30 days
  
  // A console-like object which is written to when the wrapper's state
  // changes, mostly of use for debugging. To suppress all output, set 
  // it to `null`
  logger: console
  
}, function(err, stats) {
  // ...
});
```


Caching
-------

The wrapper uses a mixture of file and memory caches to improve build times. Specifying the `cacheFile`
and `cacheKey` options will allow the wrapper to persist the cache to disk, which can massively boost 
build times for larger codebases.

When a request comes in and the cache has a record the `cacheKey` option, the cached data is compared 
against the current timestamps on both the config file and the source files. If the file system 
indicates that the cached data may be out of date, the wrapper will ignore the cached data and then 
wait for webpack to complete a fresh build.

Whenever a compiler successfully builds (either in the foreground or background), the cache is immediately 
updated with the output from the build process.
