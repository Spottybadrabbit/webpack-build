{"version":3,"sources":["../src/Wrapper.js"],"names":[],"mappings":";;;;;;;;;;;;oBAAiB,MAAM;;;;sBACT,QAAQ;;;;uBACF,SAAS;;;;uBACT,WAAW;;;;uBACX,WAAW;;;;mBACf,OAAO;;;;yBACD,cAAc;;;;sBACjB,UAAU;;;;uBACL,YAAY;;;;IAE9B,OAAO;AACA,WADP,OAAO,CACC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE;0BAD7B,OAAO;;AAET,QAAI,CAAC,IAAI,GAAG,qBAAQ,QAAQ,CAAC,IAAI,CAAC,CAAC;;AAEnC,QAAI,CAAC,MAAM,GAAG,yBAAO,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;;;;;AAK3C,QAAI,CAAC,MAAM,GAAG,MAAM,CAAC;;AAErB,QAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;;AAGnB,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACpB,QAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;;;AAGtB,QAAI,CAAC,SAAS,GAAG,EAAE,CAAC;GACrB;;eAnBG,OAAO;;WAoBD,sBAAG;AACX,UAAI,IAAI,CAAC,QAAQ,EAAE;AACjB,YAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;OAC3B;KACF;;;WACQ,mBAAC,EAAE,EAAE;AACZ,UAAI,IAAI,CAAC,MAAM,EAAE;AACf,eAAO,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;OAC9B;;AAED,UAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AACrB,eAAO,EAAE,CAAC,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC,CAAC;OAChE;;AAED,UAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;;AAE/B,UAAI,oBAAE,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AAC3B,YAAI,CAAC,MAAM,CAAC,sBAAsB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACvD,YAAI;AACF,cAAI,CAAC,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACpC,CAAC,OAAM,GAAG,EAAE;AACX,cAAI,CAAC,MAAM,GAAG,IAAI,CAAC;AACnB,iBAAO,EAAE,CAAC,GAAG,CAAC,CAAC;SAChB;OACF;;AAED,UAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE;AAChC,YAAI;AACF,sCAAU,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACnC,CAAC,OAAM,GAAG,EAAE;AACX,iBAAO,EAAE,CAAC,GAAG,CAAC,CAAC;SAChB;OACF;;AAED,UAAI,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;AAC9C,YAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;OAChD;;AAED,UAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE;AACtE,YAAI,CAAC,MAAM,CAAC,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC;AACpD,YAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzC,YAAI;AACF,aAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SAC7B,CAAC,OAAM,GAAG,EAAE;AACX,iBAAO,EAAE,CAAC,GAAG,CAAC,CAAC;SAChB;OACF;;AAED,QAAE,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;KACtB;;;WACU,qBAAC,EAAE,EAAE;AACd,UAAI,CAAC,SAAS,CAAC,CAAA,UAAS,GAAG,EAAE,MAAM,EAAE;;;AACnC,YAAI,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC;;AAExB,YAAI,QAAQ,GAAG,0BAAQ,MAAM,CAAC,CAAC;;AAE/B,gBAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,UAAC,KAAK,EAAK;AACjC,cAAI,KAAK,CAAC,SAAS,EAAE,EAAE;AACrB,kBAAK,MAAM,CAAC,gBAAgB,EAAE,oBAAE,KAAK,CAAC,KAAK,CAAC,WAAW,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;WAC3E;SACF,CAAC,CAAC;;AAEH,YAAI,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,EAAE;AAClC,kBAAQ,CAAC,MAAM,CAAC,aAAa,EAAE,UAAC,WAAW,EAAK;AAC9C,uBAAW,CAAC,WAAW,GAAG,CAAC,IAAI,IAAI,EAAE,CAAC;WACvC,CAAC,CAAC;;AAEH,kBAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,UAAC,KAAK,EAAK;;AAEjC,gBAAI,KAAK,CAAC,SAAS,EAAE,EAAE;AACrB,oBAAK,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;aACtB,MAAM;AACL,kBAAI,IAAI,GAAG;AACT,yBAAS,EAAE,KAAK,CAAC,WAAW,CAAC,WAAW;AACxC,gCAAgB,EAAE,KAAK,CAAC,WAAW,CAAC,gBAAgB;AACpD,4BAAY,EAAE;AACZ,yBAAO,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC,OAAO;AAC3C,iCAAe,EAAE,qBAAY,OAAO;iBACrC;AACD,qBAAK,EAAE,MAAK,YAAY,CAAC,KAAK,CAAC;AAC/B,sBAAM,EAAE,MAAK,IAAI,CAAC,MAAM;AACxB,oBAAI,EAAE,MAAK,IAAI,CAAC,IAAI;eACrB,CAAC;;AAEF,oBAAK,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,MAAK,IAAI,CAAC,KAAK,CAAC,CAAC;aACvC;WACF,CAAC,CAAC;SACJ;;AAED,YAAI,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACzD,2BAAI,YAAY,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACvC;;AAED,UAAE,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;OACpB,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;KACf;;;WACM,iBAAC,EAAE,EAAE;;;AACV,UAAI,CAAC,WAAW,CAAC,UAAC,GAAG,EAAE,QAAQ,EAAK;AAClC,YAAI,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC;;AAExB,gBAAQ,CAAC,GAAG,CAAC,UAAC,GAAG,EAAE,KAAK,EAAK;AAC3B,cAAI,CAAC,GAAG,IAAI,KAAK,CAAC,SAAS,EAAE,EAAE;AAC7B,eAAG,GAAG,oBAAE,KAAK,CAAC,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;WACzC;;AAED,iBAAK,MAAM,CAAC,oBAAoB,CAAC,CAAC;AAClC,iBAAK,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;SACxC,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ;;;WACW,sBAAC,KAAK,EAAE;;;AAClB,UAAI,CAAC,KAAK,EAAE,OAAO,IAAI,CAAC;;AAExB,UAAI,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC;AAC3B,eAAO,EAAE,KAAK;AACd,cAAM,EAAE,KAAK;OACd,CAAC,CAAC;;AAEH,UAAI,KAAK,CAAC,WAAW,EAAE;AACrB,iBAAS,CAAC,aAAa,GAAG,oBAAE,SAAS,CACnC,KAAK,CAAC,WAAW,CAAC,MAAM,EACxB,UAAC,MAAM,EAAE,GAAG,EAAE,KAAK;iBAAK,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,QAAQ;SAAA,EACpD,EAAE,CACH,CAAC;;AAEF,iBAAS,CAAC,YAAY,GAAG,EAAE,CAAC;AAC5B,iBAAS,CAAC,QAAQ,GAAG;AACnB,gBAAM,EAAE,EAAE;AACV,cAAI,EAAE,EAAE;SACT,CAAC;AACF,YAAI,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;AAC/C,8BAAE,OAAO,CAAC,SAAS,CAAC,aAAa,EAAE,UAAC,OAAO,EAAE,KAAK,EAAK;AACrD,gBAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,OAAK,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;;AAExD,gBAAI,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,kBAAK,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC/C,gBAAI,oBAAE,UAAU,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE;AAC7B,oBAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;aAC1B;;AAED,gBAAI,GAAG,GAAG,OAAK,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC;AACvC,qBAAS,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;;AAEpC,gBAAI,kBAAK,OAAO,CAAC,OAAO,CAAC,KAAK,MAAM,EAAE;AACpC,uBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,mCAAiC,GAAG,QAAK,CAAC;aACvE,MAAM,IAAI,kBAAK,OAAO,CAAC,OAAO,CAAC,KAAK,KAAK,EAAE;AAC1C,uBAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,mBAAiB,GAAG,iBAAc,CAAC;aAClE;WACF,CAAC,CAAC;SACJ;OACF;;AAED,UAAI,IAAI,CAAC,MAAM,EAAE;AACf,iBAAS,CAAC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC;OACvC,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAC3B,YAAI;AACF,mBAAS,CAAC,aAAa,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACrD,CAAC,OAAM,GAAG,EAAE,EAAE;OAChB;;AAED,aAAO,SAAS,CAAA;KACjB;;;WACgB,2BAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE;AAChC,UAAI,CAAC,KAAK,EAAE;AACV,eAAO,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;OACvB;;AAED,UAAI,CAAC,GAAG,IAAI,KAAK,IAAI,KAAK,CAAC,WAAW,IAAI,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE;AACzE,WAAG,GAAG,oBAAE,KAAK,CAAC,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;OACzC;;AAED,QAAE,CAAC,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;KACnC;;;WACS,oBAAC,EAAE,EAAE;;;AACb,UAAI,IAAI,CAAC,OAAO,EAAE;AAChB,eAAO,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;OAC/B;;AAED,UAAI,CAAC,WAAW,CAAC,UAAC,GAAG,EAAE,QAAQ,EAAK;AAClC,YAAI,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC;;AAExB,YAAI;AACF,iBAAK,OAAO,GAAG,yBAAY,QAAQ,EAAE,OAAK,IAAI,CAAC,CAAC;SACjD,CAAC,OAAM,GAAG,EAAE;AACX,iBAAO,EAAE,CAAC,GAAG,CAAC,CAAC;SAChB;;AAED,YAAI,OAAK,IAAI,CAAC,MAAM,EAAE;AACpB,iBAAK,OAAO,CAAC,SAAS,CAAC,YAAM;AAC3B,mBAAK,MAAM,CAAC,2BAA2B,CAAC,CAAC;WAC1C,CAAC,CAAC;SACJ;;AAED,eAAK,OAAO,CAAC,SAAS,CAAC,UAAC,GAAG,EAAK;AAC9B,iBAAK,MAAM,CAAC,gBAAgB,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;SAC1C,CAAC,CAAC;;AAEH,UAAE,CAAC,IAAI,EAAE,OAAK,OAAO,CAAC,CAAC;OACxB,CAAC,CAAC;KACJ;;;WACc,yBAAC,EAAE,EAAE;;;AAClB,UAAI,CAAC,UAAU,CAAC,UAAC,GAAG,EAAE,OAAO,EAAK;AAChC,YAAI,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC;;AAExB,eAAO,CAAC,QAAQ,CAAC,UAAC,GAAG,EAAE,KAAK,EAAK;AAC/B,cAAI,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;;AAE/B,iBAAK,MAAM,CAAC,uCAAuC,CAAC,CAAC;;AAErD,iBAAK,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;SACxC,CAAC,CAAC;;AAEH,eAAK,QAAQ,GAAG,IAAI,CAAC;OACtB,CAAC,CAAC;KACJ;;;WACO,kBAAC,EAAE,EAAE;AACX,UAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;;AAExB,UAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;;AAE/B,UAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AACnB,YAAI,IAAI,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;AAC/B,cAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAChD;OACF,MAAM;AACL,YAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;OACxC;KACF;;;WACO,kBAAC,GAAG,EAAE,KAAK,EAAE;AACnB,UAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;AAC/B,UAAI,CAAC,SAAS,GAAG,EAAE,CAAC;;AAEpB,eAAS,CAAC,OAAO,CACf,UAAC,EAAE;eAAK,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC;OAAA,CACvB,CAAC;KACH;;;SA9PG,OAAO;;;qBAiQE,OAAO","file":"Wrapper.js","sourcesContent":["import path from 'path';\nimport _ from 'lodash';\nimport webpack from 'webpack';\nimport Watcher from './Watcher';\nimport options from './options';\nimport hmr from './hmr';\nimport hmrConfig from './hmr/config';\nimport logger from './logger';\nimport packageJson from '../package';\n\nclass Wrapper {\n  constructor(opts, config, cache) {\n    this.opts = options.generate(opts);\n\n    this.logger = logger('wrapper', this.opts);\n\n    // TODO: remove this, it's mostly legacy in the test suite. Should simply pass the config obj as `opts.config`\n    // Convenience hook to pass an object in. You can also define\n    // `opts.config` as a path to a file\n    this.config = config;\n\n    this.cache = cache;\n\n    // State\n    this.watcher = null;\n    this.watching = false;\n\n    // Callbacks\n    this._onceDone = [];\n  }\n  invalidate() {\n    if (this.watching) {\n      this.watcher.invalidate();\n    }\n  }\n  getConfig(cb) {\n    if (this.config) {\n      return cb(null, this.config);\n    }\n\n    if (!this.opts.config) {\n      return cb(new Error('Wrapper options missing `config` value'));\n    }\n\n    this.config = this.opts.config;\n\n    if (_.isString(this.config)) {\n      this.logger('loading config file ' + this.opts.config);\n      try {\n        this.config = require(this.config);\n      } catch(err) {\n        this.config = null;\n        return cb(err);\n      }\n    }\n\n    if (this.config && this.opts.hmr) {\n      try {\n        hmrConfig(this.config, this.opts);\n      } catch(err) {\n        return cb(err);\n      }\n    }\n\n    if (this.opts.outputPath && this.config.output) {\n      this.config.output.path = this.opts.outputPath;\n    }\n\n    if (this.config && this.config.env && this.opts.env in this.config.env) {\n      this.logger('applying env \"' + this.opts.env + '\"');\n      let env = this.config.env[this.opts.env];\n      try {\n        env(this.config, this.opts);\n      } catch(err) {\n        return cb(err);\n      }\n    }\n\n    cb(null, this.config)\n  }\n  getCompiler(cb) {\n    this.getConfig(function(err, config) {\n      if (err) return cb(err);\n\n      let compiler = webpack(config);\n\n      compiler.plugin('done', (stats) => {\n        if (stats.hasErrors()) {\n          this.logger('build error(s)', _.pluck(stats.compilation.errors, 'stack'));\n        }\n      });\n\n      if (this.opts.config && this.cache) {\n        compiler.plugin('compilation', (compilation) => {\n          compilation.__startTime = +new Date();\n        });\n\n        compiler.plugin('done', (stats) => {\n          // TODO: get startTime/endTime from the stats\n          if (stats.hasErrors()) {\n            this.cache.set(null);\n          } else {\n            let data = {\n              startTime: stats.compilation.__startTime,\n              fileDependencies: stats.compilation.fileDependencies,\n              dependencies: {\n                webpack: require('webpack/package').version,\n                'webpack-build': packageJson.version\n              },\n              stats: this.processStats(stats),\n              config: this.opts.config,\n              hash: this.opts.hash\n            };\n\n            this.cache.set(data, this.opts.watch);\n          }\n        });\n      }\n\n      if (this.opts.watch && this.opts.hmr && this.opts.hmrRoot) {\n        hmr.bindCompiler(compiler, this.opts);\n      }\n\n      cb(null, compiler);\n    }.bind(this));\n  }\n  compile(cb) {\n    this.getCompiler((err, compiler) => {\n      if (err) return cb(err);\n\n      compiler.run((err, stats) => {\n        if (!err && stats.hasErrors()) {\n          err = _.first(stats.compilation.errors);\n        }\n\n        this.logger('compiler completed');\n        this.handleErrAndStats(err, stats, cb);\n      });\n    });\n  }\n  processStats(stats) {\n    if (!stats) return null;\n\n    let processed = stats.toJson({\n      modules: false,\n      source: false\n    });\n\n    if (stats.compilation) {\n      processed.pathsToAssets = _.transform(\n        stats.compilation.assets,\n        (result, obj, asset) => result[asset] = obj.existsAt,\n        {}\n      );\n\n      processed.urlsToAssets = {};\n      processed.rendered = {\n        script: [],\n        link: []\n      };\n      if (this.opts.staticRoot && this.opts.staticUrl) {\n        _.forEach(processed.pathsToAssets, (absPath, asset) => {\n          let relPath = absPath.replace(this.opts.staticRoot, '');\n\n          let relUrl = relPath.split(path.sep).join('/');\n          if (_.startsWith(relUrl, '/')) {\n            relUrl = relUrl.slice(1);\n          }\n\n          let url = this.opts.staticUrl + relUrl;\n          processed.urlsToAssets[asset] = url;\n\n          if (path.extname(relPath) === '.css') {\n            processed.rendered.link.push(`<link rel=\"stylesheet\" href=\"${url}\">`);\n          } else if (path.extname(relPath) === '.js') {\n            processed.rendered.script.push(`<script src=\"${url}\"></script>`);\n          }\n        });\n      }\n    }\n\n    if (this.config) {\n      processed.webpackConfig = this.config;\n    } else if (this.opts.config) {\n      try {\n        processed.webpackConfig = require(this.opts.config);\n      } catch(err) {}\n    }\n\n    return processed\n  }\n  handleErrAndStats(err, stats, cb) {\n    if (!stats) {\n      return cb(err, stats);\n    }\n\n    if (!err && stats && stats.compilation && stats.compilation.errors.length) {\n      err = _.first(stats.compilation.errors);\n    }\n\n    cb(err, this.processStats(stats));\n  }\n  getWatcher(cb) {\n    if (this.watcher) {\n      return cb(null, this.watcher);\n    }\n\n    this.getCompiler((err, compiler) => {\n      if (err) return cb(err);\n\n      try {\n        this.watcher = new Watcher(compiler, this.opts);\n      } catch(err) {\n        return cb(err);\n      }\n\n      if (this.opts.config) {\n        this.watcher.onInvalid(() => {\n          this.logger('watcher detected a change');\n        });\n      }\n\n      this.watcher.onFailure((err) => {\n        this.logger('watcher failed', err.stack);\n      });\n\n      cb(null, this.watcher);\n    });\n  }\n  onceWatcherDone(cb) {\n    this.getWatcher((err, watcher) => {\n      if (err) return cb(err);\n\n      watcher.onceDone((err, stats) => {\n        if (err) return cb(err, stats);\n\n        this.logger('watcher provided current build output');\n\n        this.handleErrAndStats(err, stats, cb);\n      });\n\n      this.watching = true;\n    });\n  }\n  onceDone(cb) {\n    this._onceDone.push(cb);\n\n    this.logger('build requested');\n\n    if (this.opts.watch) {\n      if (this._onceDone.length === 1) {\n        this.onceWatcherDone(this.callDone.bind(this));\n      }\n    } else {\n      this.compile(this.callDone.bind(this));\n    }\n  }\n  callDone(err, stats) {\n    let _onceDone = this._onceDone;\n    this._onceDone = [];\n\n    _onceDone.forEach(\n      (cb) => cb(err, stats)\n    );\n  }\n}\n\nexport default Wrapper;"]}