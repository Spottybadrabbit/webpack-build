{"version":3,"sources":["../../src/hmr/index.js"],"names":[],"mappings":";;;;;;;;oBAAiB,MAAM;;;;wBACF,WAAW;;;;+BACX,qBAAqB;;;;mBAC1B,QAAQ;;;;AAExB,IAAI,EAAE,GAAG,IAAI,CAAC;;AAEP,IAAM,WAAW,GAAG,SAAd,WAAW,CAAI,MAAM,EAAK;AACrC,IAAE,GAAG,2BAAS,MAAM,EAAE,EAAC,IAAI,EAAE,6BAAS,OAAO,EAAC,CAAC,CAAC;CACjD,CAAC;;QAFW,WAAW,GAAX,WAAW;AAIjB,IAAM,IAAI,GAAG,SAAP,IAAI,CAAI,GAAG,EAAE,KAAK,EAAK;AAClC,MACE,KAAK,IACL,KAAK,CAAC,MAAM,IACZ,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,UAAC,KAAK,EAAK;AAC5B,WAAO,CAAC,KAAK,CAAC,OAAO,CAAC;GACvB,CAAC,EACF;AACA,WAAO,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;GAC9B;;AAED,KAAG,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;;AAE7B,MAAI,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AAC3B,OAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;GAClC,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;AACpC,OAAG,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;GACtC,MAAM;AACL,OAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;GACrB;CACF,CAAC;;QApBW,IAAI,GAAJ,IAAI;AAsBV,IAAM,YAAY,GAAG,SAAf,YAAY,CAAI,QAAQ,EAAE,IAAI,EAAK;AAC9C,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC;AACpC,MAAM,MAAM,GAAG,sBAAI,KAAK,EAAE,IAAI,CAAC,CAAC;;AAEhC,MAAM,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;;AAE7B,QAAM,0CAAwC,SAAS,CAAG,CAAC;;AAE3D,KAAG,CAAC,EAAE,CAAC,YAAY,EAAE,UAAC,MAAM,EAAK;AAC/B,UAAM,gBAAc,SAAS,2BAAsB,MAAM,CAAC,EAAE,CAAG,CAAC;;AAEhE,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACpB,CAAC,CAAC;;AAEH,UAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,YAAM;AAC/B,UAAM,gCAA8B,SAAS,CAAG,CAAC;;AAEjD,OAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;GACrB,CAAC,CAAC;;AAEH,UAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,UAAC,KAAK,EAAK;AACjC,UAAM,+BAA6B,SAAS,CAAG,CAAC;;AAEhD,QAAI,CAAC,GAAG,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;GAC3B,CAAC,CAAC;CACJ,CAAC;;QAzBW,YAAY,GAAZ,YAAY;qBA2BV;AACb,aAAW,EAAX,WAAW;AACX,MAAI,EAAJ,IAAI;AACJ,cAAY,EAAZ,YAAY;CACb","file":"index.js","sourcesContent":["import path from 'path';\nimport socketIo from 'socket.io';\nimport defaults from '../options/defaults';\nimport log from '../log';\n\nlet io = null;\n\nexport const addToServer = (server) => {\n  io = socketIo(server, {path: defaults.hmrPath});\n};\n\nexport const send = (nsp, stats) => {\n  if (\n    stats &&\n    stats.assets &&\n    stats.assets.every((asset) => {\n      return !asset.emitted;\n    })\n  ) {\n    return nsp.emit('no-change');\n  }\n\n  nsp.emit('hash', stats.hash);\n\n  if (stats.errors.length > 0) {\n    nsp.emit('errors', stats.errors);\n  } else if (stats.warnings.length > 0) {\n    nsp.emit('warnings', stats.warnings);\n  } else {\n    nsp.emit('success');\n  }\n};\n\nexport const bindCompiler = (compiler, opts) => {\n  const namespace = opts.hmrNamespace;\n  const logger = log('hmr', opts);\n\n  const nsp = io.of(namespace);\n\n  logger(`bound compiler under hmr namespace: ${namespace}`);\n\n  nsp.on('connection', (socket) => {\n    logger(`namespace ${namespace} opened connection ${socket.id}`);\n\n    socket.emit('hot');\n  });\n\n  compiler.plugin('invalid', () => {\n    logger(`sending invalid signal to ${namespace}`);\n\n    nsp.emit('invalid');\n  });\n\n  compiler.plugin('done', (stats) => {\n    logger(`sending updated stats to ${namespace}`);\n\n    send(nsp, stats.toJson());\n  });\n};\n\nexport default {\n  addToServer,\n  send,\n  bindCompiler\n}"]}